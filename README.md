# LightGBMによる都営地下鉄各駅利用者数予測

この成果物は、**東京都営大江戸線の各駅における乗降者数を予測**するものです。  
2011年〜2021年の駅別乗降者数データおよび地価データを活用し、機械学習手法 **LightGBM** を用いて2022年以降の利用者数を推定しました。

## 成果物概要
- **目的**: 都営大江戸線各駅での2年分(2022・2023)の利用者数の変動を予測し、都営大江戸線のどの駅を重視していくか検討する材料を提供する。 
- **対象データ**:  
  - 都営大江戸線　駅別乗降者数（2011〜2021年）  
  - 国土交通省公開の地価データ  https://nlftp.mlit.go.jp/ksj/index.html
- **手法**:  
  - 1年遅れの乗降者数・地価を特徴量に追加（lag特徴量）  
  - LightGBM による回帰予測  
  - 2022年・2023年の実測値と比較し、MAE（平均絶対誤差）で評価  

## 実装ファイル
### 🔹 `build_metro_master.py`
- **役割**: XML形式の元データ（乗降者数・地価）から分析用のCSVを生成  
- **処理内容**:
  - 2011〜2022年の駅別乗降者数を抽出・整形  
  - 国交省の地価データを年度ごとに集約  
  - 両者をマージしてマスターデータを作成  
  - 地価が欠損または0の駅を除外したクリーンデータを出力  
- **出力ファイル例**:
  - `oedo_2022.csv・oedo_2023.csv` … 各年度の乗降者数  
  - `landprice_2017_2021.csv` … 地価データ(ファイル名は2017からになっているが実際は2011から)  
  - `oedo_master_2011_2021_clean.csv` … 解析用の統合データセット  

### 🔹 `metro_pasenger_pred.py`
- **役割**: 大江戸線の駅別乗降者数を機械学習で予測  
- **処理内容**:
  - lag特徴量の生成（乗降者数・地価の1年遅れ）  
  - LightGBMによる回帰モデル構築  
  - 2021年データから2022年を予測 → 再帰的に2023年も予測  
  - 実測値と比較しMAEを算出  
  - 結果をExcelに出力（誤差の増減を含む）

## 成果物
- `oedo_predictions_with_errors.xlsx`  
  各駅ごとの予測値・実測値・誤差をまとめたファイル  


## 使用技術
- Python (pandas, numpy, scikit-learn, lightgbm, seaborn, matplotlib)
- XML処理: ElementTree
- Excel出力: openpyxl
- 評価指標: Mean Absolute Error (MAE)

## 今後の展望
- 郊外路線データの追加による精度検証
- 天候・イベント・人口動態など外部データを特徴量に追加
- LightGBM以外の手法（XGBoost, CatBoost, LSTM等）との比較
